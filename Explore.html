<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.4.0/fonts/remixicon.css" rel="stylesheet" />
    <link rel="stylesheet" href="style.css?v=1.3" />
    <title>SayadiAirways - Explore Destinations</title>
    <style>
      .explore__header {
        background: linear-gradient(135deg, rgba(44, 56, 85, 0.95), rgba(99, 167, 255, 0.85)), url('Icons/Flight.jpg') center/cover;
        padding: 80px 0;
        margin-bottom: 0;
      }
      
      .map-section {
        background: linear-gradient(180deg, #f8fafc 0%, #ffffff 100%);
        padding: 60px 0;
      }
      
      .map-wrapper {
        position: relative;
        background: linear-gradient(145deg, #ffffff, #f0f4f8);
        border-radius: 24px;
        box-shadow: 0 20px 60px rgba(44, 56, 85, 0.12), 0 8px 25px rgba(0,0,0,0.08);
        padding: 20px;
        overflow: hidden;
      }
      
      .map-container {
        position: relative;
        width: 100%;
        height: 550px;
        border-radius: 16px;
        overflow: hidden;
        background: linear-gradient(180deg, #e3f2fd 0%, #bbdefb 50%, #90caf9 100%);
        cursor: grab;
        touch-action: none;
      }
      
      .map-container:active {
        cursor: grabbing;
      }
      
      .map-container svg {
        width: 100%;
        height: 100%;
        display: block;
      }
      
      .svg-country {
        fill: #4a6fa5;
        stroke: #ffffff;
        stroke-width: 0.5;
        cursor: pointer;
        transition: all 0.3s ease;
        outline: none;
      }
      
      .svg-country:hover,
      .svg-country:focus {
        fill: #63a7ff;
        stroke: #2c3855;
        stroke-width: 1.5;
        filter: drop-shadow(0 4px 8px rgba(99, 167, 255, 0.4));
      }
      
      .svg-country:focus-visible {
        stroke: #ffc107;
        stroke-width: 3;
      }
      
      .svg-country.active {
        fill: #ff6b6b;
        stroke: #c0392b;
        stroke-width: 2;
        filter: drop-shadow(0 6px 12px rgba(255, 107, 107, 0.5));
      }
      
      .map-controls {
        position: absolute;
        bottom: 20px;
        right: 20px;
        display: flex;
        flex-direction: column;
        gap: 8px;
        z-index: 100;
      }
      
      .map-controls button {
        width: 44px;
        height: 44px;
        border-radius: 12px;
        border: none;
        background: white;
        box-shadow: 0 4px 15px rgba(0,0,0,0.15);
        font-size: 20px;
        font-weight: 600;
        color: #2c3855;
        cursor: pointer;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      
      .map-controls button:hover {
        background: #63a7ff;
        color: white;
        transform: scale(1.1);
      }
      
      .map-info-panel {
        position: absolute;
        top: 20px;
        left: 20px;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 16px;
        padding: 16px 20px;
        box-shadow: 0 8px 32px rgba(0,0,0,0.12);
        z-index: 100;
        min-width: 200px;
        transition: all 0.3s ease;
      }
      
      .map-info-panel h4 {
        margin: 0 0 8px 0;
        font-size: 14px;
        color: #64748b;
        text-transform: uppercase;
        letter-spacing: 1px;
      }
      
      .map-info-panel .country-name {
        font-size: 22px;
        font-weight: 700;
        color: #2c3855;
        margin-bottom: 12px;
      }
      
      .country-popup {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%) scale(0.9);
        background: white;
        border-radius: 24px;
        padding: 40px;
        box-shadow: 0 25px 80px rgba(0,0,0,0.25);
        z-index: 10000;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        max-width: 420px;
        width: 90%;
        text-align: center;
      }
      
      .country-popup.active {
        opacity: 1;
        visibility: visible;
        transform: translate(-50%, -50%) scale(1);
      }
      
      .country-popup-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0,0,0,0.5);
        backdrop-filter: blur(4px);
        z-index: 9999;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
      }
      
      .country-popup-overlay.active {
        opacity: 1;
        visibility: visible;
      }
      
      .country-popup .popup-icon {
        width: 80px;
        height: 80px;
        background: linear-gradient(135deg, #63a7ff, #2c3855);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 20px;
        font-size: 36px;
        color: white;
      }
      
      .country-popup h3 {
        font-size: 28px;
        font-weight: 700;
        color: #2c3855;
        margin-bottom: 8px;
      }
      
      .country-popup .popup-subtitle {
        color: #64748b;
        margin-bottom: 24px;
      }
      
      .country-popup .popup-features {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin-bottom: 28px;
      }
      
      .country-popup .popup-feature {
        text-align: center;
      }
      
      .country-popup .popup-feature i {
        font-size: 24px;
        color: #63a7ff;
        margin-bottom: 4px;
        display: block;
      }
      
      .country-popup .popup-feature span {
        font-size: 12px;
        color: #64748b;
      }
      
      .country-popup .btn-book-now {
        display: inline-flex;
        align-items: center;
        gap: 10px;
        background: linear-gradient(135deg, #63a7ff, #4a8fe0);
        color: white;
        padding: 16px 40px;
        border-radius: 50px;
        font-size: 18px;
        font-weight: 600;
        text-decoration: none;
        transition: all 0.3s ease;
        box-shadow: 0 8px 25px rgba(99, 167, 255, 0.4);
      }
      
      .country-popup .btn-book-now:hover {
        transform: translateY(-3px);
        box-shadow: 0 12px 35px rgba(99, 167, 255, 0.5);
        background: linear-gradient(135deg, #4a8fe0, #2c3855);
      }
      
      .country-popup .close-popup {
        position: absolute;
        top: 16px;
        right: 16px;
        width: 36px;
        height: 36px;
        border-radius: 50%;
        border: none;
        background: #f1f5f9;
        color: #64748b;
        font-size: 20px;
        cursor: pointer;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      
      .country-popup .close-popup:hover {
        background: #e2e8f0;
        color: #2c3855;
      }
      
      .quick-destinations {
        margin-top: 40px;
      }
      
      .quick-destinations h3 {
        text-align: center;
        margin-bottom: 30px;
        color: #2c3855;
      }
      
      .destination-chip {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        background: white;
        padding: 12px 20px;
        border-radius: 50px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
        color: #2c3855;
        font-weight: 500;
        border: 2px solid transparent;
      }
      
      .destination-chip:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(99, 167, 255, 0.2);
        border-color: #63a7ff;
        color: #63a7ff;
      }
      
      .destination-chip i {
        color: #63a7ff;
      }
      
      .features-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 24px;
        margin-top: 60px;
      }
      
      @media (max-width: 992px) {
        .features-grid {
          grid-template-columns: repeat(2, 1fr);
        }
      }
      
      @media (max-width: 576px) {
        .features-grid {
          grid-template-columns: 1fr;
        }
        .map-container {
          height: 400px;
        }
      }
      
      .feature-card {
        background: white;
        border-radius: 20px;
        padding: 32px 24px;
        text-align: center;
        box-shadow: 0 10px 40px rgba(0,0,0,0.06);
        transition: all 0.3s ease;
      }
      
      .feature-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 20px 50px rgba(0,0,0,0.12);
      }
      
      .feature-card .icon-wrapper {
        width: 70px;
        height: 70px;
        background: linear-gradient(135deg, rgba(99, 167, 255, 0.15), rgba(99, 167, 255, 0.05));
        border-radius: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 20px;
      }
      
      .feature-card .icon-wrapper i {
        font-size: 32px;
        color: #63a7ff;
      }
      
      .feature-card h4 {
        font-size: 18px;
        font-weight: 600;
        margin-bottom: 10px;
        color: #2c3855;
      }
      
      .feature-card p {
        font-size: 14px;
        color: #64748b;
        margin: 0;
        line-height: 1.6;
      }
      
      .map-legend {
        display: flex;
        justify-content: center;
        gap: 30px;
        margin-top: 20px;
        flex-wrap: wrap;
      }
      
      .legend-item {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 14px;
        color: #64748b;
      }
      
      .legend-color {
        width: 16px;
        height: 16px;
        border-radius: 4px;
      }
      
      .legend-color.available {
        background: #4a6fa5;
      }
      
      .legend-color.hover {
        background: #63a7ff;
      }
      
      .legend-color.selected {
        background: #ff6b6b;
      }
    </style>
  </head>
  <body>
    <nav class="navbar navbar-expand-lg">
      <div class="container-fluid">
        <a class="navbar-brand d-flex align-items-center" href="Home.html">
          <img src="Icons/logo.png" alt="SayadiAirways Logo" />
          <span class="nav__brand ms-2">SayadiAirways</span>
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
          <span class="text-white"><i class="ri-menu-3-line"></i></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ms-auto align-items-center">
            <li class="nav-item">
              <a class="nav-link text-white" href="Home.html"><i class="ri-home-line"></i> Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link text-white" href="Book.html"><i class="ri-plane-line"></i> Book</a>
            </li>
            <li class="nav-item">
              <a class="nav-link text-white active" aria-current="page" href="Explore.html"><i class="ri-map-pin-line"></i> Explore</a>
            </li>
            <li class="nav-item">
              <a class="nav-link text-white" href="Experience.html"><i class="ri-gift-line"></i> Experience</a>
            </li>
            <li class="nav-item">
              <a class="nav-link text-white" href="Contact.html"><i class="ri-phone-line"></i> Contact</a>
            </li>
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle text-white" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                <i class="ri-briefcase-line"></i> Manage
              </a>
              <ul class="dropdown-menu">
                <li><a class="dropdown-item" href="ModifyBooking.html"><i class="ri-edit-box-line"></i> Modify Booking</a></li>
                <li><a class="dropdown-item" href="CancelBooking.html"><i class="ri-close-circle-line"></i> Cancel Booking</a></li>
                <li><hr class="dropdown-divider"></li>
                <li><a class="dropdown-item" href="CheckIn.html"><i class="ri-calendar-check-line"></i> Check-In</a></li>
                <li><a class="dropdown-item" href="FlightStatus.html"><i class="ri-flight-takeoff-line"></i> Flight Status</a></li>
              </ul>
            </li>
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle text-white" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                <i class="ri-add-circle-line"></i> Extras
              </a>
              <ul class="dropdown-menu">
                <li><a class="dropdown-item" href="ExtraBaggage.html"><i class="ri-luggage-cart-line"></i> Extra Baggage</a></li>
                <li><a class="dropdown-item" href="CarRental.html"><i class="ri-car-line"></i> Car Rental</a></li>
                <li><a class="dropdown-item" href="HotelBooking.html"><i class="ri-hotel-line"></i> Hotel</a></li>
                <li><hr class="dropdown-divider"></li>
                <li><a class="dropdown-item" href="TravelInsurance.html"><i class="ri-shield-line"></i> Travel Insurance</a></li>
              </ul>
            </li>
            <li class="nav-item">
              <a class="nav-link text-white" href="Login.html"><i class="ri-user-line"></i> Login</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <section class="section__container explore__header">
      <div class="container">
        <div class="explore__hero text-center text-white">
          <h1 class="section__header text-white mb-3">Explore Amazing Destinations</h1>
          <p class="lead">Click on any country to discover your next adventure with SayadiAirways</p>
        </div>
      </div>
    </section>

    <section class="map-section">
      <div class="container">
        <div class="map-wrapper">
          <div class="map-container" id="mapContainer">
            <svg id="worldMap" viewBox="0 0 1200 600" preserveAspectRatio="xMidYMid meet">
              <defs>
                <linearGradient id="oceanGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                  <stop offset="0%" style="stop-color:#e3f2fd"/>
                  <stop offset="50%" style="stop-color:#bbdefb"/>
                  <stop offset="100%" style="stop-color:#90caf9"/>
                </linearGradient>
              </defs>
              <rect width="1200" height="600" fill="url(#oceanGradient)"/>
              <g id="countriesGroup" class="countries-layer"></g>
              <g id="markersGroup" class="markers-layer"></g>
            </svg>
            
            <div class="map-info-panel" id="infoPanel">
              <h4><i class="ri-earth-line"></i> Selected Destination</h4>
              <div class="country-name" id="countryDisplay">Click a country</div>
              <p style="margin: 0; font-size: 13px; color: #94a3b8;">Use mouse to drag and scroll to zoom</p>
            </div>
            
            <div class="map-controls">
              <button id="zoomInBtn" title="Zoom In"><i class="ri-add-line"></i></button>
              <button id="zoomOutBtn" title="Zoom Out"><i class="ri-subtract-line"></i></button>
              <button id="resetBtn" title="Reset View"><i class="ri-refresh-line"></i></button>
            </div>
          </div>
          
          <div class="map-legend">
            <div class="legend-item">
              <div class="legend-color available"></div>
              <span>Available Destinations</span>
            </div>
            <div class="legend-item">
              <div class="legend-color hover"></div>
              <span>Hover</span>
            </div>
            <div class="legend-item">
              <div class="legend-color selected"></div>
              <span>Selected</span>
            </div>
          </div>
        </div>
        
        <div class="quick-destinations">
          <h3><i class="ri-flight-takeoff-line"></i> Popular Destinations</h3>
          <div class="d-flex flex-wrap justify-content-center gap-3">
            <a href="Book.html?country=Qatar" class="destination-chip"><i class="ri-map-pin-2-fill"></i> Qatar</a>
            <a href="Book.html?country=Morocco" class="destination-chip"><i class="ri-map-pin-2-fill"></i> Morocco</a>
            <a href="Book.html?country=France" class="destination-chip"><i class="ri-map-pin-2-fill"></i> France</a>
            <a href="Book.html?country=Spain" class="destination-chip"><i class="ri-map-pin-2-fill"></i> Spain</a>
            <a href="Book.html?country=United%20Kingdom" class="destination-chip"><i class="ri-map-pin-2-fill"></i> United Kingdom</a>
            <a href="Book.html?country=Turkey" class="destination-chip"><i class="ri-map-pin-2-fill"></i> Turkey</a>
            <a href="Book.html?country=United%20Arab%20Emirates" class="destination-chip"><i class="ri-map-pin-2-fill"></i> UAE</a>
            <a href="Book.html?country=Thailand" class="destination-chip"><i class="ri-map-pin-2-fill"></i> Thailand</a>
            <a href="Book.html?country=Japan" class="destination-chip"><i class="ri-map-pin-2-fill"></i> Japan</a>
            <a href="Book.html?country=Australia" class="destination-chip"><i class="ri-map-pin-2-fill"></i> Australia</a>
            <a href="Book.html?country=Brazil" class="destination-chip"><i class="ri-map-pin-2-fill"></i> Brazil</a>
            <a href="Book.html?country=Canada" class="destination-chip"><i class="ri-map-pin-2-fill"></i> Canada</a>
          </div>
        </div>
        
        <div class="features-grid">
          <div class="feature-card">
            <div class="icon-wrapper">
              <i class="ri-global-line"></i>
            </div>
            <h4>150+ Destinations</h4>
            <p>Fly to over 150 destinations across 6 continents worldwide</p>
          </div>
          <div class="feature-card">
            <div class="icon-wrapper">
              <i class="ri-price-tag-3-line"></i>
            </div>
            <h4>Best Price Guarantee</h4>
            <p>Competitive prices with no hidden fees or surprises</p>
          </div>
          <div class="feature-card">
            <div class="icon-wrapper">
              <i class="ri-shield-check-line"></i>
            </div>
            <h4>Safe & Secure</h4>
            <p>Your safety is our top priority on every flight</p>
          </div>
          <div class="feature-card">
            <div class="icon-wrapper">
              <i class="ri-customer-service-2-line"></i>
            </div>
            <h4>24/7 Support</h4>
            <p>Round-the-clock customer service in multiple languages</p>
          </div>
        </div>
      </div>
    </section>

    <div class="country-popup-overlay" id="popupOverlay" aria-hidden="true"></div>
    <div class="country-popup" id="countryPopup" role="dialog" aria-modal="true" aria-labelledby="popupCountryName" aria-hidden="true">
      <button class="close-popup" id="closePopup" aria-label="Close dialog"><i class="ri-close-line"></i></button>
      <div class="popup-icon">
        <i class="ri-plane-fill"></i>
      </div>
      <h3 id="popupCountryName">Country Name</h3>
      <p class="popup-subtitle">Your next adventure awaits</p>
      <div class="popup-features">
        <div class="popup-feature">
          <i class="ri-flight-takeoff-line"></i>
          <span>Direct Flights</span>
        </div>
        <div class="popup-feature">
          <i class="ri-price-tag-3-line"></i>
          <span>Best Prices</span>
        </div>
        <div class="popup-feature">
          <i class="ri-calendar-check-line"></i>
          <span>Flexible Dates</span>
        </div>
      </div>
      <a href="#" class="btn-book-now" id="bookNowBtn">
        <i class="ri-plane-fill"></i> Book Flight Now
      </a>
    </div>

    <footer class="footer-section">
      <div class="container">
        <div class="row g-4 py-5">
          <div class="col-lg-4 col-md-6">
            <div class="d-flex align-items-center mb-3">
              <img src="Icons/logo.png" alt="Logo" style="height: 50px; width: auto; margin-right: 10px;">
              <h4 class="mb-0 text-white">SayadiAirways</h4>
            </div>
            <p class="text-light opacity-75">Your trusted airline partner for memorable journeys around the world.</p>
          </div>
          <div class="col-lg-2 col-md-6">
            <h5 class="text-white mb-3">Quick Links</h5>
            <ul class="list-unstyled">
              <li class="mb-2"><a href="Home.html" class="text-light text-decoration-none opacity-75">Home</a></li>
              <li class="mb-2"><a href="Book.html" class="text-light text-decoration-none opacity-75">Book</a></li>
              <li class="mb-2"><a href="Explore.html" class="text-light text-decoration-none opacity-75">Explore</a></li>
              <li class="mb-2"><a href="Contact.html" class="text-light text-decoration-none opacity-75">Contact</a></li>
            </ul>
          </div>
          <div class="col-lg-3 col-md-6">
            <h5 class="text-white mb-3">Services</h5>
            <ul class="list-unstyled">
              <li class="mb-2"><a href="CheckIn.html" class="text-light text-decoration-none opacity-75"><i class="ri-calendar-check-line"></i> Online Check-In</a></li>
              <li class="mb-2"><a href="FlightStatus.html" class="text-light text-decoration-none opacity-75"><i class="ri-flight-takeoff-line"></i> Flight Status</a></li>
              <li class="mb-2"><a href="ExtraBaggage.html" class="text-light text-decoration-none opacity-75"><i class="ri-luggage-cart-line"></i> Extra Baggage</a></li>
              <li class="mb-2"><a href="TravelInsurance.html" class="text-light text-decoration-none opacity-75"><i class="ri-shield-check-line"></i> Travel Insurance</a></li>
            </ul>
          </div>
          <div class="col-lg-3 col-md-6">
            <h5 class="text-white mb-3">Contact Us</h5>
            <ul class="list-unstyled text-light opacity-75">
              <li class="mb-2"><i class="ri-phone-line"></i> +216 71 234 567</li>
              <li class="mb-2"><i class="ri-mail-line"></i> info@sayadiairways.com</li>
              <li class="mb-2"><i class="ri-map-pin-line"></i> Tunis, Tunisia</li>
            </ul>
          </div>
        </div>
        <div class="border-top border-secondary pt-4 pb-3 text-center">
          <p class="text-light opacity-75 mb-0">&copy; 2025 SayadiAirways. All rights reserved.</p>
        </div>
      </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const svg = document.getElementById('worldMap');
        const countriesGroup = document.getElementById('countriesGroup');
        const mapContainer = document.getElementById('mapContainer');
        const infoPanel = document.getElementById('infoPanel');
        const countryDisplay = document.getElementById('countryDisplay');
        const popup = document.getElementById('countryPopup');
        const popupOverlay = document.getElementById('popupOverlay');
        const popupCountryName = document.getElementById('popupCountryName');
        const bookNowBtn = document.getElementById('bookNowBtn');
        const closePopup = document.getElementById('closePopup');
        
        const svgNS = 'http://www.w3.org/2000/svg';
        const width = 1200, height = 600;
        
        let currentScale = 1;
        let currentX = 0;
        let currentY = 0;
        let isDragging = false;
        let startX, startY;
        let hasDragged = false;
        
        function project(lat, lon) {
          const x = (lon + 180) * (width / 360);
          const y = (90 - lat) * (height / 180);
          return [x, y];
        }
        
        function applyTransform() {
          countriesGroup.style.transition = isDragging ? 'none' : 'transform 0.3s ease';
          countriesGroup.style.transform = `translate(${currentX}px, ${currentY}px) scale(${currentScale})`;
          countriesGroup.style.transformOrigin = '600px 300px';
        }
        
        function zoomIn() {
          if (currentScale < 4) {
            currentScale *= 1.3;
            applyTransform();
          }
        }
        
        function zoomOut() {
          if (currentScale > 0.5) {
            currentScale /= 1.3;
            currentX *= 0.8;
            currentY *= 0.8;
            applyTransform();
          }
        }
        
        function resetView() {
          currentScale = 1;
          currentX = 0;
          currentY = 0;
          applyTransform();
        }
        
        document.getElementById('zoomInBtn').addEventListener('click', zoomIn);
        document.getElementById('zoomOutBtn').addEventListener('click', zoomOut);
        document.getElementById('resetBtn').addEventListener('click', resetView);
        
        mapContainer.addEventListener('wheel', function(e) {
          e.preventDefault();
          if (e.deltaY < 0) {
            zoomIn();
          } else {
            zoomOut();
          }
        }, { passive: false });
        
        mapContainer.addEventListener('mousedown', function(e) {
          isDragging = true;
          hasDragged = false;
          startX = e.clientX - currentX;
          startY = e.clientY - currentY;
          mapContainer.style.cursor = 'grabbing';
        });
        
        document.addEventListener('mousemove', function(e) {
          if (!isDragging) return;
          
          const dx = e.clientX - startX;
          const dy = e.clientY - startY;
          
          if (Math.abs(dx - currentX) > 5 || Math.abs(dy - currentY) > 5) {
            hasDragged = true;
          }
          
          currentX = dx;
          currentY = dy;
          applyTransform();
        });
        
        document.addEventListener('mouseup', function() {
          isDragging = false;
          mapContainer.style.cursor = 'grab';
        });
        
        let touchStartX, touchStartY;
        mapContainer.addEventListener('touchstart', function(e) {
          if (e.touches.length === 1) {
            isDragging = true;
            hasDragged = false;
            touchStartX = e.touches[0].clientX - currentX;
            touchStartY = e.touches[0].clientY - currentY;
          }
        }, { passive: true });
        
        mapContainer.addEventListener('touchmove', function(e) {
          if (!isDragging || e.touches.length !== 1) return;
          hasDragged = true;
          currentX = e.touches[0].clientX - touchStartX;
          currentY = e.touches[0].clientY - touchStartY;
          applyTransform();
        }, { passive: true });
        
        mapContainer.addEventListener('touchend', function() {
          isDragging = false;
        });
        
        function showPopup(countryName) {
          popupCountryName.textContent = countryName;
          bookNowBtn.href = 'Book.html?country=' + encodeURIComponent(countryName);
          popup.classList.add('active');
          popupOverlay.classList.add('active');
          popup.setAttribute('aria-hidden', 'false');
          setTimeout(() => bookNowBtn.focus(), 100);
        }
        
        function hidePopup() {
          popup.classList.remove('active');
          popupOverlay.classList.remove('active');
          popup.setAttribute('aria-hidden', 'true');
          if (lastFocusedElement) {
            lastFocusedElement.focus();
          }
        }
        
        closePopup.addEventListener('click', hidePopup);
        popupOverlay.addEventListener('click', hidePopup);
        
        document.addEventListener('keydown', function(e) {
          if (e.key === 'Escape') hidePopup();
        });
        
        let selectedCountry = null;
        let lastFocusedElement = null;
        
        function handleCountryClick(e, countryName) {
          if (hasDragged) {
            hasDragged = false;
            return;
          }
          
          lastFocusedElement = e.target;
          document.querySelectorAll('.svg-country').forEach(p => p.classList.remove('active'));
          e.target.classList.add('active');
          selectedCountry = countryName;
          countryDisplay.textContent = countryName;
          showPopup(countryName);
        }
        
        function handleCountryHover(e, countryName) {
          if (!selectedCountry) {
            countryDisplay.textContent = countryName;
          }
        }
        
        function handleCountryLeave() {
          if (!selectedCountry) {
            countryDisplay.textContent = 'Click a country';
          }
        }
        
        const geojsonUrl = 'https://raw.githubusercontent.com/datasets/geo-countries/master/data/countries.geojson';
        
        fetch(geojsonUrl)
          .then(response => response.json())
          .then(geojson => {
            geojson.features.forEach(feature => {
              const coords = feature.geometry.coordinates;
              const type = feature.geometry.type;
              const props = feature.properties || {};
              const name = props.ADMIN || props.NAME || props.name || 'Unknown';
              
              function polygonToPath(poly) {
                let d = '';
                poly.forEach(ring => {
                  ring.forEach((pt, idx) => {
                    const p = project(pt[1], pt[0]);
                    d += (idx === 0 ? 'M' : 'L') + p[0] + ' ' + p[1];
                  });
                  d += ' Z ';
                });
                return d;
              }
              
              let pathD = '';
              if (type === 'Polygon') {
                pathD = polygonToPath(coords);
              } else if (type === 'MultiPolygon') {
                coords.forEach(poly => { pathD += polygonToPath(poly); });
              }
              
              if (pathD) {
                const path = document.createElementNS(svgNS, 'path');
                path.setAttribute('d', pathD);
                path.setAttribute('class', 'svg-country');
                path.setAttribute('data-country', name);
                path.setAttribute('tabindex', '0');
                path.setAttribute('role', 'button');
                path.setAttribute('aria-label', 'Book flight to ' + name);
                
                const title = document.createElementNS(svgNS, 'title');
                title.textContent = name;
                path.appendChild(title);
                
                path.addEventListener('click', (e) => handleCountryClick(e, name));
                path.addEventListener('keydown', (e) => {
                  if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    handleCountryClick(e, name);
                  }
                });
                path.addEventListener('mouseenter', (e) => handleCountryHover(e, name));
                path.addEventListener('mouseleave', handleCountryLeave);
                path.addEventListener('focus', (e) => handleCountryHover(e, name));
                path.addEventListener('blur', handleCountryLeave);
                
                countriesGroup.appendChild(path);
              }
            });
          })
          .catch(err => {
            console.warn('Could not load country data:', err);
            countryDisplay.textContent = 'Map loading...';
          });
      });
    </script>
  </body>
</html>
